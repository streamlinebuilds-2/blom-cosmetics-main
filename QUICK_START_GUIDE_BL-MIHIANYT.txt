================================================================================
ğŸ¯ QUICK GUIDE: Order BL-MIHIANYT - PayFast ITN Test & Order Info
================================================================================

ğŸ“‹ ORDER DETAILS:
   Order ID: c7c88c8d-a961-4692-9ae7-fbfacf151e88
   Order Number: BL-MIHIANYT  
   PayFast Payment ID: BL-19AC5A26DD5
   Total: R290
   Customer: annamarie ernst (ernstannamarie18@gmail.com)
   Current Status: placed/unpaid

================================================================================
ğŸš€ STEP 1: GET COMPLETE ORDER INFORMATION
================================================================================

ğŸ“ Files Created:
   âœ… get_order_BL-MIHIANYT_complete.sql - All SQL queries you need

ğŸ“ To run the queries:
   1. Copy the SQL from get_order_BL-MIHIANYT_complete.sql
   2. Run in your Supabase SQL editor or database client
   3. You'll see: Order header, items, summary, customer info, stock impact

================================================================================
ğŸš€ STEP 2: TEST PAYFAST ITN WEBHOOK (Mark Order as Paid)
================================================================================

ğŸ“ Files Created:
   âœ… test_payfast_itn_BL-MIHIANYT.js - Ready-to-run Node.js script
   âœ… payfast_itn_test_BL-MIHIANYT.txt - Detailed instructions
   âœ… verify_order_BL-MIHIANYT.js - Verification script

âš¡ FASTEST METHOD - Run the Node.js script:
   node test_payfast_itn_BL-MIHIANYT.js

ğŸ”§ ALTERNATIVE METHODS:
   1. Use curl command (see detailed instructions file)
   2. Use Postman/Insomnia (copy form data from instructions)
   3. Use your HTTP workflow tool (n8n, Make, etc.)

================================================================================
ğŸš€ STEP 3: VERIFY ORDER WAS MARKED AS PAID
================================================================================

ğŸ“‹ After sending the webhook, run this SQL query:

SELECT 
    order_number, 
    status, 
    payment_status, 
    total, 
    buyer_email, 
    paid_at
FROM public.orders 
WHERE id = 'c7c88c8d-a961-4692-9ae7-fbfacf151e88';

âœ… EXPECTED RESULTS:
   - status: "paid" 
   - payment_status: "paid"
   - paid_at: [timestamp]

================================================================================
ğŸ” WHAT HAPPENS IN YOUR WORKFLOW:
================================================================================

When you send the PayFast ITN webhook:
1. âœ… Validates signature and payment status
2. âœ… Finds your order by m_payment_id = "BL-19AC5A26DD5" 
3. âœ… Updates status: "placed" â†’ "paid"
4. âœ… Updates payment_status: "unpaid" â†’ "paid"
5. âœ… Sets paid_at timestamp
6. âœ… Triggers new order alert
7. âœ… Marks coupon as used (if applicable)
8. âœ… Enrolls in courses (if applicable)
9. âœ… Creates payment record
10. âœ… Generates invoice
11. âœ… Forwards to n8n workflow

================================================================================
âš¡ QUICK START - Copy & Paste Commands:
================================================================================

ğŸ—ƒï¸  GET ORDER INFO:
   Copy SQL from: get_order_BL-MIHIANYT_complete.sql

ğŸš€  TEST WEBHOOK:
   node test_payfast_itn_BL-MIHIANYT.js

ğŸ”  VERIFY RESULT:
   SELECT order_number, status, payment_status, paid_at 
   FROM public.orders 
   WHERE id = 'c7c88c8d-a961-4692-9ae7-fbfacf151e88';

================================================================================